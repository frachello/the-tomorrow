/*! event-organiser-pro 1.8.1 2014-08-11 22:40 */
jQuery(document).ready(function(a){function b(){a("#eventorganiser_tickets tbody.eo-ticket-row").removeClass("eo-first-ticket eo-last-ticket"),a("#eventorganiser_tickets tbody.eo-ticket-row:visible:first").addClass("eo-first-ticket"),a("#eventorganiser_tickets tbody.eo-ticket-row:visible:last").addClass("eo-last-ticket")}a.widget("eventorganiser.eo_occurrencepicker",{options:{value:0,ticket:!1,selected:[-1],deslected:[]},year:!1,month:!1,rule:{},ticket:function(a){return void 0===a?this.options.ticket:void(this.options.ticket=this._absint(a))},_create:function(){this.options.onSelect=this.add_or_remove_date,this.options.beforeShowDay=this.pre_show_date,this.options.onChangeMonthYear=this.generate_dates;var b=a(" #eop_ticket_selected_"+this.ticket()).val().split(","),c=a(" #eop_ticket_deselected_"+this.ticket()).val().split(",");0===b.length&&0===c.length?(this.selected([-1]),this.deselected([])):(this.selected(b),this.deselected(c))},_init:function(){this.element.datepicker(this.options);var a=new Date;this.year=a.getFullYear(),this.month=a.getMonth()+1},refresh:function(){this.set_occurrences(this.year,this.month),this.element.datepicker("refresh")},selected:function(b){return void 0===b?this.options.selected:(this.options.selected=this._array_filter(b),void a(" #eop_ticket_selected_"+this.ticket()).val(this.options.selected.join(",")))},deselected:function(b){return void 0===b?this.options.deselected:(this.options.deselected=this._array_filter(b),void a(" #eop_ticket_deselected_"+this.ticket()).val(this.options.deselected.join(",")))},select_all:function(){this.selected([-1]),this.deselected([]),this.element.datepicker("refresh")},deselect_all:function(){this.selected([""]),this.deselected([]),this.element.datepicker("refresh")},pre_show_date:function(b){var c=a.datepicker.formatDate("dd-mm-yy",b),d=a(this).eo_occurrencepicker("selected"),e=a(this).eo_occurrencepicker("deselected"),f=a(this).eo_occurrencepicker("is_date_eventful",b);if(f[0]){var g=a.inArray(c,d),h=a.inArray(c,e);return g>-1&&"-1"!=d[0]||"-1"==d[0]&&-1==h?[!0,"ui-state-active eo-pro-selected",""]:[!0,"ui-state-active",""]}return[!1,"ui-state-disabled",""]},add_or_remove_date:function(b){var c=a(this).eo_occurrencepicker("selected"),d=a(this).eo_occurrencepicker("deselected"),e=a.inArray(b,c),f=a.inArray(b,d);"-1"==c[0]&&f>-1?d.splice(f,1):"-1"==c[0]?d.push(b):e>-1?c.splice(e,1):c.push(b),a(this).eo_occurrencepicker("selected",c),a(this).eo_occurrencepicker("deselected",d)},is_date_eventful:function(b){var c=a.datepicker.formatDate("dd-mm-yy",b),d=a.datepicker.formatDate("yy-mm-dd",b),e=a.inArray(c,this.options.occurrences_by_rule);if(e>-1){var f=a.inArray(d,eo_exclude_dates);return f>-1?[!1,f]:[!0,-1]}var g=a.inArray(d,eo_include_dates);return g>-1?[!0,g]:[!1,-1]},generate_dates:function(b,c){a(this).eo_occurrencepicker("set_occurrences",b,c)},set_occurrences:function(b,c){var d=new Date(b,c-1,1),e=new Date(b,c,1),f=new Date(e-1);this.rule=rule={start:a("#from_date").datepicker("getDate"),end:a("#recend").datepicker("getDate"),schedule:a("#HWSEventInput_Req").val(),frequency:parseInt(a("#HWSEvent_freq").val(),10)},this.year=d.getFullYear(),this.month=d.getMonth()+1,this.options.occurrences_by_rule=rule.end>=d&&rule.start<=f?this.generate_dates_by_rule(rule,d,f):[]},generate_dates_by_rule:function(b,c,d){var e=[],f=[],g=!1,h=b.start,i=b.end,j=b.schedule,k=b.frequency;switch(j){case"once":case"custom":var l=a.datepicker.formatDate("dd-mm-yy",h);return e.push(l),e;case"daily":var m=0;c>h?(m=Math.round(Math.abs((c-h)/864e5)),m=k-m%k):m=parseInt(h.getDate(),10)-1;var n=k,o=new Date(c);o.setDate(c.getDate()+m),f.push(o);break;case"weekly":var p=a("#dayofweekrepeat :checkbox:checked"),q=new Array("SU","MO","TU","WE","TH","FR","SA");p.each(function(b){b=q.indexOf(a(this).val());var d=new Date(h);if(d.setDate(h.getDate()+(b-h.getDay()+7)%7),c>d){var e=Math.abs((c-h)/864e5);e-=e%(7*k),d.setDate(d.getDate()+e)}f.push(d)}),n=7*k;break;case"monthly":var r=12*(c.getFullYear()-h.getFullYear())+(c.getMonth()-h.getMonth());if(r%k!==0)return e;var s=a('input[name="eo_input[schedule_meta]"]:checked').val();if("BYMONTHDAY="==s){var t=h.getDate(),u=d.getDate();u>=t&&(g=new Date(c.getFullYear(),c.getMonth(),t))}else{var v,w=Math.ceil(h.getDate()/7),x=h.getDay();if(w>=5){var y=d.getDay();v=d.getDate()+(x-y-7)%7}else{var z=c.getDay(),A=(x-z+7)%7;v=A+7*(w-1)+1}g=new Date(c),g.setDate(v)}return i>=g&&(l=a.datepicker.formatDate("dd-mm-yy",g),e.push(l)),e;case"yearly":var B=c.getFullYear()-h.getFullYear();if(B%k!==0)return e;var C=new Date(c.getFullYear(),h.getMonth(),h.getDate());return C.getMonth()==h.getMonth()&&C.getMonth()==h.getMonth()&&(g=new Date(h),g.setYear(c.getFullYear()),i>=g&&(l=a.datepicker.formatDate("dd-mm-yy",g),e.push(l))),e;default:return e}for(var D in f)for(g=new Date(f[D]);d>=g&&i>=g;)l=a.datepicker.formatDate("dd-mm-yy",g),e.push(l),g.setDate(g.getDate()+n);return e},_absint:function(a){return Math.abs(parseInt(a,10))},_array_filter:function(b){return a.grep(b,function(a){return a})}}),a("#eventorganiser_tickets").on("click",".eo-ticket-input-to, .eo-ticket-input-from",function(){a(this).datepicker({dateFormat:EO_Ajax_Event.format,changeMonth:!0,changeYear:!0,monthNamesShort:EO_Ajax_Event.locale.monthAbbrev,dayNamesMin:EO_Ajax_Event.locale.dayAbbrev,firstDay:parseInt(EO_Ajax_Event.startday,10)}).datepicker("show")}),a("#eventorganiser_tickets").on("click",".eo-ticket-input-to-time, .eo-ticket-input-from-time",function(){var b=eo_pro;a(this).timepicker({showPeriodLabels:!b.is24hour,showPeriod:!b.is24hour,showLeadingZero:b.is24hour,periodSeparator:"",amPmText:b.locale.meridian,hourText:b.locale.hour,minuteText:b.locale.minute}).timepicker("show")}),a("#eventorganiser_tickets").on("click",".eo-move-ticket-up, .eo-move-ticket-down",function(c){c.preventDefault();var d,e=a(this).parents("tbody"),f=e.find(".eo-ticket-order").val();a(this).is(".eo-move-ticket-up")?(d=e.prev(":visible").find(".eo-ticket-order").val(),e.find(".eo-ticket-order").val(d),e.prev(":visible").find(".eo-ticket-order").val(f),e.insertBefore(e.prev(":visible"))):a(this).is(".eo-move-ticket-down")&&(d=e.next(":visible").find(".eo-ticket-order").val(),e.find(".eo-ticket-order").val(d),e.next(":visible").find(".eo-ticket-order").val(f),e.insertAfter(e.next(":visible"))),b()}),b(),a("#eventorganiser_tickets").on("click",".eo-delete-ticket",function(c){c.preventDefault();var d=a(this).parents("tbody");d.find("td.column-ticket .eo-ticket-action").val("delete"),d.css("background-color","red").fadeOut(400,b)}),a("#eventorganiser_tickets").on("click","#eo-add-ticket",function(c){c.preventDefault(),a("#eventorganiser_tickets .eo-ticket-table tr.no-items").remove();var d=a("#eventorganiser_tickets .eo-ticket-table tbody.eo-ticket-row").length,e=eo_ticket_table_template;e=e.replace(/%%rows%%/g,d),e=e.replace(/%%name%%/g,""),e=e.replace(/%%selected%%/g,"-1"),e=e.replace(/%%deselected%%/g,""),e=e.replace(/%%spaces%%/g,""),e=e.replace(/%%price%%/g,""),e=e.replace(/%%from%%/g,""),e=e.replace(/%%from_time%%/g,""),e=e.replace(/%%to%%/g,""),e=e.replace(/%%to_time%%/g,""),e=e.replace(/%%ticket_id%%/g,""),a("#eventorganiser_tickets .eo-ticket-table").append(e),a("#eo-ticket-row-"+d+" .eo-edit-ticket").trigger("click"),a("#eventorganiser_tickets .eo-ticket-table .eo-inline-help").each(function(){var b=a(this).attr("id").substr(15);a(this).click(function(a){a.preventDefault()}),a(this).qtip({content:{text:eoHelp[b].content,title:{text:eoHelp[b].title}},show:{solo:!0},hide:"unfocus",style:{classes:"qtip-wiki qtip-light qtip-shadow"},position:{viewport:a(window)}})}),b()}),a("#eventorganiser_tickets").on("keyup",".eo-ticket-input-name",function(){var b=a(this).parents("tbody.eo-ticket-row");b.find(".eo-ticket-name").text(a(this).val())}),a("#eventorganiser_tickets").on("keyup",".eo-ticket-input-price",function(){var b=a(this).parents("tbody.eo-ticket-row"),c=a(this).val().replace(/,/g,"");a(this).val(c),b.find(".eo-ticket-price").text(c)}),a("#eventorganiser_tickets").on("change",".eo-ticket-input-price",function(){a(this).val(parseFloat(a(this).val()).toFixed(2));var b=a(this).parents("tbody.eo-ticket-row");b.find(".eo-ticket-price").text(a(this).val())}),a("#eventorganiser_tickets").on("keyup click",".eo-ticket-input-spaces",function(){var b=a(this).parents("tbody.eo-ticket-row");b.find(".eo-ticket-spaces").text(a(this).val())}),a("#eventorganiser_tickets").on("click",".eo-select-all, .eo-deselect-all",function(b){b.preventDefault();var c=a(this).parents("tbody.eo-ticket-row"),d=c.find(".eo-ticket-occurrences-input");a(this).hasClass("eo-select-all")?d.eo_occurrencepicker("select_all"):a(this).hasClass("eo-deselect-all")&&d.eo_occurrencepicker("deselect_all")}),a("#eventorganiser_tickets").on("click",".eo-edit-ticket",function(b){b.preventDefault();var c=a(this).parents("tbody.eo-ticket-row"),d=c.data("eo-ticket-row-id");if(a("#ticket-"+d+"-settings").toggle(),a("#ticket-"+d+"-settings").is(":visible")){c.addClass("eo-ticket-row-expanded"),c.find(".eo-edit-ticket .eo-settings-toggle-arrow").html("&#x25B2;");var e=c.find(".eo-ticket-occurrences-input"),f={dateFormat:"dd-mm-yy",changeMonth:!0,changeYear:!0,monthNamesShort:EO_Ajax_Event.locale.monthAbbrev,dayNamesMin:EO_Ajax_Event.locale.dayAbbrev,firstDay:parseInt(EO_Ajax_Event.startday,10),ticket:d};e.eo_occurrencepicker(f),e.datepicker("refresh"),e.eo_occurrencepicker("refresh")}else c.removeClass("eo-ticket-row-expanded"),c.find(".eo-edit-ticket .eo-settings-toggle-arrow").html("&#x25BC;")})});