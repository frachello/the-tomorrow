/*! event-organiser-pro 1.8.1 2014-08-11 22:40 */
!function(a){var b=eo.bfc={Model:{},View:{},Collection:{}};eo.gettext=function(a){return void 0!==this.locale[a]?this.locale[a]:a},eo.add_query_arg=function(a,b,c){var d=new RegExp("([?&])"+a+"=.*?(&|$)","i"),e=-1!==c.indexOf("?")?"&":"?";return c.match(d)?c.replace(d,"$1"+a+"="+b+"$2"):c+e+a+"="+b},b.Model.EOFormController=Backbone.Model.extend(),b.Model.EOForm=Backbone.Model.extend({defaults:{name:eo.gettext("Booking form"),title:eo.gettext("Bookings"),notice_classes:"eo-booking-notice",error_classes:"eo-booking-error"},url:function(){var a=eo.add_query_arg("action","eo-bfc-form",eo.url);return a=eo.add_query_arg("_nonce",eo.nonce,a),this.isNew()?a:a+"&id="+this.id},settings:[{id:"name",label:eo.gettext("Name"),type:"input",inline_help:{title:eo.gettext("Booking Form Name"),text:eo.gettext("This is only used to help you identify the form on the event admin page.")}},{id:"title",label:eo.gettext("Title"),type:"input"},{id:"error_classes",label:eo.gettext("Error classes"),type:"input"},{id:"notice_classes",label:eo.gettext("Notice classes"),type:"input"}],elements:!1,initialize:function(){this.on("change:elements",this.setUpElements,this),this.on("change",this.setUpSettings,this),this.elements=new b.Collection.EOFormElements,this._settings=new b.Collection.EOFormSettings(this.settings),this.setUpElements(),this.setUpSettings()},setUpElements:function(){var a=this;this.elements.reset(),this.get("elements")&&_.each(this.get("elements"),function(b){a.add(b)}),this.elements.sort({silent:!0})},setUpSettings:function(){var a=this;this._settings.each(function(b){"checkbox"==b.get("type")?b.set("checked",parseInt(a.get(b.get("id")),10)):b.set("value",a.get(b.get("id")))})},add:function(a,b){b="undefined"!=typeof b?b:{},b.at=a instanceof Backbone.Model?a.get("position"):a.position,b.at||"0"===b.at||0===b.at||(b.at=this.elements.length),this.elements.add(a,b)},remove:function(a){this.elements.remove(a)},toJSON:function(){var a=Backbone.Model.prototype.toJSON.call(this);return a.elements=this.elements.toJSON(),a}}),b.Model.EOFormElement=Backbone.Model.extend({settings:!1,deletable:!0,can_have_children:!1,defaults:{label:!1,placeholder:"",description:"",required:!1,parent:0},url:function(){var a=eo.add_query_arg("action","eo-bfc-form-element",eo.url);return a=eo.add_query_arg("_nonce",eo.nonce,a),this.isNew()?a:a+"&id="+this.id},initialize:function(){if("radiobox"==this.get("type")&&this.set("type","radio"),this.settings){var a=this,c=new b.Collection.EOFormSettings;_.each(this.settings,function(d){switch(d.live_update=1,d.type){case"input":case"textarea":d.value=a.get(d.id);break;case"checkbox":d.checked=a.get(d.id);break;case"options":d.options=a.get(d.id),d.selected=a.get("selected");break;case"range":d.value_min=a.get(d.min_id),d.value_max=a.get(d.max_id)}d=new b.Model.EOFormSetting(d),c.add(d)}),this.settings=c,this.on("change",this.update_settings_value)}this.can_have_children&&(this.elements=new b.Collection.EOFormElements,this.elements.reset(),this.get("elements")&&_.each(this.get("elements"),function(b){a.elements.add(b)}),this.elements.sort({silent:!0}))},update_settings_value:function(){if(this.settings){var a=this;this.settings.each(function(b){switch(b.get("type")){case"input":case"textarea":b.set("value",a.get(b.id));break;case"checkbox":b.set("checked",a.get(b.id));break;case"options":b.set("options",a.get(b.id)),b.options=a.get(b.id),b.set("selected",a.get("selected"));break;case"range":b.set({value_min:a.get(b.get("min_id")),value_max:a.get(b.get("max_id"))})}})}},toJSON:function(){var a=Backbone.Model.prototype.toJSON.call(this);return a.position=void 0!==this.collection?this.collection.indexOf(this):-1,"undefined"!=typeof a.selected&&(a.checked=a.selected),this.can_have_children&&"undefined"!=typeof this.elements&&(a.elements=this.elements.toJSON()),a},is_deletable:function(){var a=this.deletable;return _.isFunction(a)?a.apply(this):a}});var c=b.Model.EOFormElement;b.Model.EOFormElementAddress=c.extend({defaults:{label:eo.gettext("Address"),name:eo.gettext("Address"),components:["street-address","2nd-line","city","state","postcode","country"],required:!1,description:"",parent:0},settings:[{id:"label",label:eo.gettext("Label"),type:"input"},{id:"components",label:eo.gettext("Address includes"),type:"checkbox",options:{"street-address":eo.gettext("Street address"),"2nd-line":eo.gettext("Second line"),city:eo.gettext("City"),state:eo.gettext("State"),postcode:eo.gettext("Postcode"),country:eo.gettext("Country")}},{id:"required",label:eo.gettext("Required"),type:"checkbox"},{id:"description",label:eo.gettext("Description"),type:"textarea"},{id:"class",label:eo.gettext("CSS Class"),type:"input"}]}),b.Model.EOFormElementAntispam=c.extend({settings:[{id:"description",label:eo.gettext("Description"),type:"textarea"},{id:"class",label:eo.gettext("CSS Class"),type:"input"}]}),b.Model.EOFormElementCheckbox=c.extend({defaults:{label:eo.gettext("Label"),name:eo.gettext("Checkbox"),options:["Option A","Option B","Option C"],required:!1,selected:[],multiselect:!0,description:"",parent:0},settings:[{id:"label",label:eo.gettext("Label"),type:"input"},{id:"options",label:eo.gettext("Options"),type:"options",option_type:"checkbox"},{id:"required",label:eo.gettext("Required"),type:"checkbox"},{id:"description",label:eo.gettext("Description"),type:"textarea"},{id:"class",label:eo.gettext("CSS Class"),type:"input"}]}),b.Model.EOFormElementFieldset=c.extend({defaults:{name:eo.gettext("Fieldset"),label:eo.gettext("Label"),parent:0},can_have_children:!0,settings:[{id:"label",label:eo.gettext("Label"),type:"input"},{id:"class",label:eo.gettext("CSS Class"),type:"input"}]}),b.Model.EOFormElementGateway=c.extend({defaults:{name:eo.gettext("Gateway picker"),label:eo.gettext("Select a payment gateway"),parent:0},settings:[{id:"label",label:eo.gettext("Label"),type:"input"},{id:"class",label:eo.gettext("CSS Class"),type:"input"}],deletable:!1}),b.Model.EOFormElementHook=c.extend({defaults:{name:eo.gettext("Hook"),"wp-action":"some_custom_action",parent:0},settings:[{id:"wp-action",label:eo.gettext("Hook"),type:"input"}]}),b.Model.EOFormElementHtml=c.extend({defaults:{name:eo.gettext("HTML"),parent:0},settings:[{id:"html",label:eo.gettext("HTML"),type:"textarea"}]}),b.Model.EOFormElementName=c.extend({defaults:{label:eo.gettext("Name"),name:eo.gettext("Bookee name"),placeholder:"",required:!0,parent:0},settings:[{id:"label",label:eo.gettext("Label"),type:"input"},{id:"lname",label:eo.gettext("Include second name"),type:"checkbox"},{id:"class",label:eo.gettext("CSS Class"),type:"input"}],deletable:function(){return"name"!=this.id}}),b.Model.EOFormElementInput=c.extend({defaults:{label:eo.gettext("Label"),name:eo.gettext("Text field"),placeholder:"",description:"",required:!1,field_type:"text",parent:0},settings:[{id:"label",label:eo.gettext("Label"),type:"input"},{id:"required",label:eo.gettext("Required"),type:"checkbox"},{id:"description",label:eo.gettext("Description"),type:"textarea"},{id:"placeholder",label:eo.gettext("Placeholder"),type:"input"},{id:"class",label:eo.gettext("CSS Class"),type:"input"}]}),b.Model.EOFormElementAntispam=b.Model.EOFormElementInput.extend({defaults:{name:eo.gettext("Antispam"),label:eo.gettext("What is x + y?"),placeholder:"",description:"",required:!0,field_type:"text",parent:0},settings:[{id:"description",label:eo.gettext("Description"),type:"textarea"},{id:"class",label:eo.gettext("CSS Class"),type:"input"}]}),b.Model.EOFormElementDate=b.Model.EOFormElementInput.extend({defaults:{name:eo.gettext("Date"),label:eo.gettext("Date"),description:"",required:!1,field_type:"text",format:"Y-m-d",opening_date:"today",parent:0},settings:[{id:"label",label:eo.gettext("Label"),type:"input"},{id:"required",label:eo.gettext("Required"),type:"checkbox"},{id:"description",label:eo.gettext("Description"),type:"textarea"},{id:"format",label:eo.gettext("Date format"),type:"input"},{id:"opening_date",label:eo.gettext("Opening date"),type:"input"},{id:"class",label:eo.gettext("CSS Class"),type:"input"}]}),b.Model.EOFormElementButton=c.extend({defaults:{name:eo.gettext("Button"),label:eo.gettext("Submit"),button_text:eo.gettext("Book"),"class":"eo-booking-button",parent:0},settings:[{id:"label",label:eo.gettext("Label"),type:"input"},{id:"class",label:eo.gettext("CSS Class"),type:"input"}],deletable:!1}),b.Model.EOFormElementEmail=b.Model.EOFormElementInput.extend({defaults:{name:eo.gettext("E-mail"),label:eo.gettext("E-mail"),placeholder:"john@example.com",description:"",required:!1,field_type:"text",parent:0},deletable:function(){return"email"!=this.id}}),b.Model.EOFormElementNumber=b.Model.EOFormElementInput.extend({defaults:{name:eo.gettext("Number"),label:eo.gettext("Number"),placeholder:"",description:"",required:!1,min:!1,max:!1,field_type:"number",parent:0},settings:[{id:"label",label:eo.gettext("Label"),type:"input"},{id:"required",label:eo.gettext("Required"),type:"checkbox"},{id:"description",label:eo.gettext("Description"),type:"textarea"},{id:"placeholder",label:eo.gettext("Placeholder"),type:"input"},{id:"range",label:eo.gettext("Range"),min_id:"min",label_min:eo.gettext("Min"),max_id:"max",label_max:eo.gettext("Max"),type:"range"},{id:"class",label:eo.gettext("CSS Class"),type:"input"}]}),b.Model.EOFormElementPhone=b.Model.EOFormElementInput.extend({defaults:{name:eo.gettext("Phone"),label:eo.gettext("Phone"),placeholder:"",description:"",required:!1,field_type:"text",parent:0}}),b.Model.EOFormElementUrl=b.Model.EOFormElementInput.extend({defaults:{label:eo.gettext("Website"),name:eo.gettext("Website"),placeholder:"http://",description:"",required:!1,field_type:"text",parent:0}}),b.Model.EOFormElementMultiselect=c.extend({defaults:function(){return{label:eo.gettext("Label"),name:eo.gettext("Multiselect"),options:["Option A","Option B","Option C"],required:!1,selected:[],multiselect:!0,description:"",parent:0}},settings:[{id:"label",label:eo.gettext("Label"),type:"input"},{id:"options",label:eo.gettext("Options"),type:"options",option_type:"checkbox"},{id:"required",label:eo.gettext("Required"),type:"checkbox"},{id:"description",label:eo.gettext("Description"),type:"textarea"},{id:"class",label:eo.gettext("CSS Class"),type:"input"}]}),b.Model.EOFormElementRadio=c.extend({defaults:{label:eo.gettext("Label"),name:eo.gettext("Radio"),options:["Option A","Option B","Option C"],required:!1,selected:!1,description:"",parent:0},settings:[{id:"label",label:eo.gettext("Label"),type:"input"},{id:"options",label:eo.gettext("Options"),type:"options",option_type:"radio"},{id:"required",label:eo.gettext("Required"),type:"checkbox"},{id:"description",label:eo.gettext("Description"),type:"textarea"},{id:"class",label:eo.gettext("CSS Class"),type:"input"}]}),b.Model.EOFormElementSection=c.extend({defaults:{name:eo.gettext("Section"),label:eo.gettext("Section"),parent:0},settings:[{id:"label",label:eo.gettext("Label"),type:"input"},{id:"class",label:eo.gettext("CSS Class"),type:"input"}]}),b.Model.EOFormElementSelect=c.extend({defaults:{label:eo.gettext("Label"),name:eo.gettext("Select"),options:["Option A","Option B","Option C"],required:!1,multiselect:!1,selected:[],description:"",parent:0},settings:[{id:"label",label:eo.gettext("Label"),type:"input"},{id:"options",label:eo.gettext("Options"),type:"options",option_type:"radio"},{id:"required",label:eo.gettext("Required"),type:"checkbox"},{id:"description",label:eo.gettext("Description"),type:"textarea"},{id:"class",label:eo.gettext("CSS Class"),type:"input"}]}),b.Model.EOFormElementTermsConditions=c.extend({defaults:{name:eo.gettext("Terms & Conditions"),label:eo.gettext("Terms & Conditions"),terms:eo.gettext("Your terms & conditions"),terms_accepted_label:eo.gettext("I have read and agree to the terms and conditions detailed above."),required:!0,parent:0},settings:[{id:"label",label:eo.gettext("Label"),type:"input"},{id:"required",label:eo.gettext("Required"),type:"checkbox"},{id:"terms",label:eo.gettext("Terms"),type:"textarea"},{id:"terms_accepted_label",label:eo.gettext("Checkbox label"),type:"input"},{id:"class",label:eo.gettext("CSS Class"),type:"input"}]}),b.Model.EOFormElementTextarea=c.extend({defaults:{label:eo.gettext("Label"),name:eo.gettext("Textarea"),placeholder:"",description:"",required:!1,parent:0},settings:[{id:"label",label:eo.gettext("Label"),type:"input"},{id:"required",label:eo.gettext("Required"),type:"checkbox"},{id:"description",label:eo.gettext("Description"),type:"textarea"},{id:"class",label:eo.gettext("CSS Class"),type:"input"}]}),b.Model.EOFormElementTicketpicker=c.extend({settings:[{id:"use_select",label:eo.gettext("Use drop-down list"),type:"checkbox",inline_help:{title:eo.gettext("Date selection"),text:eo.gettext("If checked a drop-down select menu is used for selecting a date, rather than a datepicker.")}},{id:"simple_mode",label:eo.gettext("Simple Booking Mode"),type:"checkbox",inline_help:{title:eo.gettext("Simple Booking Mode"),text:eo.gettext("Simple Booking Mode only comes into effect if:<ul><li>This option is selected.</li><li>The event has only one ticket currently on sale.</li><li>You are booking by series, or the event is non-recurring (no date needs to be selected).</li></ul>Under those conditions the date and ticket selection is hidden from the booking form, and the booking consist of only one ticket.")}}],defaults:{use_select:0,name:eo.gettext("Ticket picker"),parent:0},deletable:!1}),b.Model.EOFormSetting=Backbone.Model.extend({defaults:{inline_help:!1},toJSON:function(){var a=Backbone.Model.prototype.toJSON.apply(this,arguments);return a.cid=this.cid,a},removeOptionAt:function(a){var b=this.get("options"),c=_.clone(this.get("selected"));"radio"==this.get("option_type")?c&&(c==a?c=!1:c>a&&c--):(c=_.filter(_.clone(c),function(b){return b!==a}),c=_.map(c,function(b){return b>a?b-1:b})),b&&(b=_.reject(b,function(b,c){return c==a})),this.set({options:b,selected:c})},insertOptionAt:function(a,b){var c=_.clone(this.get("options")),d=_.clone(this.get("selected"));"radio"==this.get("option_type")?d&&(d=d>=b?d+1:d):d=_.map(d,function(a){return a>=b?a+1:a}),c?c.splice(b,0,a):c=[a],this.set({options:c,selected:d})},setSelected:function(a){"radio"==this.get("option_type")&&(a=a?_.first(a):!1),this.set("selected",a)},setOption:function(a,b){var c=_.clone(this.get("options"));c[b]=a,this.set("options",c)},is_selected:function(a){var b=this.get("selected");return"radio"==this.get("option_type")?b===a:_.indexOf(b,a)>-1}}),b.Collection.EOFormElements=Backbone.Collection.extend({model:function(a,c){var d="EOFormElement"+("_"+a.type).replace(/[_|-]([a-z])/g,function(a){return a[1].toUpperCase()}),e=b.Model[d];return"undefined"==typeof e?new b.Model.EOFormElement(a,c):new e(a,c)},comparator:function(a){return a.get("position")}}),b.Collection.EOFormSettings=Backbone.Collection.extend({model:b.Model.EOFormSetting}),b.View.EOFormControllerView=Backbone.View.extend({el:"#poststuff",template:_.template(a("#tmpl-eo-form-controller").html()),initialize:function(){_.bindAll(this,"render"),this.formView=!1,this.model.get("form").on("change:id",this.render,this),this.model.get("form").on("change:name",this.renderForms,this),this.model.on("change:forms",this.renderForms,this)},events:{"click #eo-bfc-form-tabs li a":"tabClicked","click #side-sortables .handlediv":"fieldBinToggleClicked","click .eventorganiser-field-bin li":"addField","click .eo-bfc-delete-form":"deleteFormClicked","click .eo-bfc-add-form-btn":"addFormClicked","click .eo-bfc-edit-form-btn":"editFormClicked","keyup .eo-bfc-setting-name":"editFormName"},render:function(){return a(".wrap .submit").remove(),a(this.el).html(this.template(this.model.toJSON())),this.renderForms(),a("#side-sortables",this.el).html(""),_.each(this.model.get("metaboxes"),function(b){a("#side-sortables").append(_.template(a("#tmpl-eo-form-element-bin").html(),b))}),a("#side-sortables .postbox:gt(0)",this.el).addClass("closed"),this.formView&&this.formView.close(),this.formView=new b.View.EOFormView({model:this.model.get("form")}),this.formView.render(),a(".form-toolbar-option input",this.el).val(this.model.get("form").get("name")),a(window).on("scroll click.postboxes",function(){var b=parseInt(a(this).scrollTop(),10),c=parseInt(a("#wpfooter").position().top,10),d=parseInt(a("#eo-bfc-form").offset().top,10),e=parseInt(a("#eventorganiser-form-fixed-mb").height(),10),f=b+d+e;a("#eventorganiser-form-fixed-mb").css(c-f>-20?{position:"fixed",top:a("#eo-bfc-form").offset().top}:{position:"absolute",top:c-e+"px"})}).trigger("click.postboxes"),this},rerender:function(){this.render()},renderForms:function(){a(".eo-bfc-edit-form",this.el).html("");var b=this;_.each(this.model.get("forms"),function(c){var d=c.id==b.model.get("form").get("id")?'selected="selected"':"";a(".eo-bfc-edit-form",this.el).append('<option value="'+c.id+'" '+d+"> "+c.name+" ("+c.id+")</option>")})},tabClicked:function(b){b.preventDefault(),a("#eo-bfc-form-tabs li").removeClass("active"),a(this.el).find(".eo-booking-form-tabbed-area").hide(),a(b.currentTarget).parent("li").addClass("active"),a(this.el).find("#"+a(b.currentTarget).attr("aria-controls")).show()},fieldBinToggleClicked:function(b){a(b.target,this.el).parent(".postbox").toggleClass("closed")},addField:function(c){var d,e=this,f=a(c.currentTarget).data("type"),g="EOFormElement"+("_"+f).replace(/[_|-]([a-z])/g,function(a){return a[1].toUpperCase()});d="undefined"!=typeof b.Model[g]?new b.Model[g]({type:f}):new b.Model.EOFormElement({type:f}),d.save(null,{success:function(a,b){a.set(b),e.model.get("form").elements.add(a,{scroll:!0})},emulateHTTP:!0})},deleteFormClicked:function(c){if(c.preventDefault(),confirm('Are you sure you want to delete the form "'+this.model.get("form").get("name")+'"?\n\n This action cannot be undone.')){var d=this;a("#eo-bfc-form",this.el).append(a('<div class="eo-bfc-ajax-overlay">')),this.model.get("form").destroy({emulateHTTP:!0,success:function(c){var e=c.get("id"),f=_.filter(d.model.get("forms"),function(a){return a.id!=e});d.model.set("forms",f);var g=_.first(f);if(void 0!==g){var h=new b.Model.EOForm({id:g.id});h.fetch({success:function(a,b){a.set(b),d.model.set("form",a),d.rerender()}})}else a("#eo-bfc-form",this.el).html("<h3>"+eo.gettext('No form found... <a href="#" title="Create a new form" class="eo-bfc-add-form-btn">create new</a>')+"</h3>")},error:function(a,b){}})}},editFormClicked:function(c){c.preventDefault();var d=a("#eo-bfc-edit-form",this.el).val(),e=new b.Model.EOForm({id:d});a("#eo-bfc-form",this.el).append(a('<div class="eo-bfc-ajax-overlay">'));var f=this;e.fetch({success:function(a,b){a.set(b),f.model.set("form",a),f.rerender()}})},addFormClicked:function(c){c.preventDefault();var d=this,e=new b.Model.EOForm({});a("#eo-bfc-form",this.el).append(a('<div class="eo-bfc-ajax-overlay">')),e.save(null,{wait:!0,success:function(a,b){a.set(b);var c=d.model.get("forms");c.push(a.toJSON()),d.model.set("forms",c),d.model.set("form",e),d.rerender()},error:function(){},emulateHTTP:!0})},editFormName:function(b){var c=this;forms=this.model.get("forms"),_.map(forms,function(d){d.id==c.model.get("form").get("id")&&(d.name=a(b.target).val())}),this.model.set("forms",forms),this.model.get("form").set("name",a(b.target).val())}}),b.View.EOFormView=Backbone.View.extend({el:"#eo-bfc-form",template:_.template(a("#tmpl-eo-form").html()),events:{"update-sort":"updatePositions","click .eo-bfc-save-form-btn":"saveForm"},initialize:function(){_.bindAll(this,"render","updatePositions","addElement"),this.model.elements.on("add",this.addElement,this),this.model.bind("request",this.ajaxStart,this),this.model.bind("sync",this.ajaxComplete,this)},ajaxStart:function(){a(this.el).find(".eo-bfc-save-form-btn").prop("disabled",!0),a(this.el).find(".spinner").show()},ajaxComplete:function(){a(this.el).find(".eo-bfc-save-form-btn").prop("disabled",!1),a(this.el).find(".spinner").hide()},render:function(){a(this.el).html(this.template(this.model.toJSON()));var c=this;return this.model.elements.each(function(a){c.addElement(a)}),a("ul.eo-bfc-element-root-list").nestedSortable({listType:"ul",disableNesting:"eo-bfc-element-no-children",errorClass:"eo-bfc-placeholder-error",handle:"h3",helper:"clone",items:".eo-bfc-element",placeholder:"eo-bfc-placeholder",tolerance:"pointer",toleranceElement:".eo-bfc-form-element",maxLevels:3,update:function(a,b){b.item.trigger("drop",b.item.index())}}),this.model._settings.each(function(d){settingView=new b.View.EOFormSettingView({model:d}),a("#eventorganiser-form-settings",this.el).append(settingView.render().el),d.on("change",c.updateSetting,c)}),this},addElement:function(c,d,e){var f,g=b.View;switch(c.get("type")){case"input":case"url":case"email":case"date":case"phone":case"number":case"antispam":case"discount-code":f=new g.EOFormElementInputView({model:c});break;case"multiselect":f=new g.EOFormElementSelectView({model:c});break;default:f=new g.EOFormElementView({model:c})}var h=f.render().el;a("ul#eventorganiser-form-fields",self.el).append(h),e&&e.scroll&&a("html, body").animate({scrollTop:a(h).offset().top-50},400)},updatePositions:function(a,b,c){b.collection.indexOf(b),b.get("parent");b.set("parent",0,{silent:!0}),b.collection.remove(b,{silent:!0}),this.model.elements.add(b,{at:c,silent:!0})},updateSetting:function(a){var b="checkbox"==a.get("type")?parseInt(a.get("selected"),10):a.get("value");this.model.set(a.get("id"),b)},saveForm:function(a){a.preventDefault(),this.model.save(null,{silent:!0,emulateHTTP:!0})},close:function(){this.remove(),this.unbind(),this.model.unbind()}}),b.View.EOFormElementView=Backbone.View.extend({tagName:"li",className:"eo-bfc-element",template:_.template(a("#tmpl-eo-form-element").html()),exampleTemplate:!1,events:{"click .inside, .handlediv":"toggleSettingsVisibility",drop:"dropped","click .inside .eo-bfc-settings":"stopPropagation","click a.submitdelete":"deleteElement","update-sort ul":"updatePositions"},initialize:function(){if(_.bindAll(this,"render","toggleSettingsVisibility","dropped","rerender","updatePositions","addElement"),!this.exampleTemplate){var b=this.model.get("type");this.exampleTemplate=a("#tmpl-eo-form-element-example-"+b).html()}this.model.can_have_children?this.model.elements.on("add",this.addElement,this):this.$el.addClass("eo-bfc-element-no-children"),this.$el.addClass("eo-bfc-element-"+this.model.get("type")),this.model.on("change",this.rerender,this)},render:function(){var b=_.extend(this.model.toJSON(),{can_have_children:this.model.can_have_children});if(this.$el.append(this.template(b)),this.renderExample(),this.renderSettings(),this.model.can_have_children){var c=this;this.model.elements.each(function(a){c.addElement(a)})}return this.model.is_deletable()&&a("#eo-bfc-element-"+this.model.id+" .eo-bfc-settings",this.el).append('<span class="submitbox"><a href="#" class="submitdelete" title="Delete this element">Delete Element</a></span>'),this},rerender:function(){return this.renderExample(),this},deleteElement:function(a){a.preventDefault(),this.model.collection.remove(this.model),this.undelegateEvents(),this.$el.removeData().unbind(),this.remove(),Backbone.View.prototype.remove.call(this)},renderExample:function(){var b=this.model.toJSON();"undefined"!=typeof b["wp-action"]&&(b.action=b["wp-action"]),this.exampleTemplate&&a("#eo-bfc-element-"+this.model.id+" .eo-bfc-example",this.el).html(_.template(this.exampleTemplate,b))},renderSettings:function(){if(this.model.settings){var c=this;a(".eo-bfc-settings",this.el).html('<table class="form-table"></table>'),this.model.settings.each(function(d){var e;switch(d.get("type")){case"input":case"textarea":case"checkbox":case"range":e=new b.View.EOFormSettingView({model:d});break;case"options":e=new b.View.EOFormElementSettingOptionsView({model:d})}d.on("change",c.updateSettings,c),a(".eo-bfc-settings table",c.el).append(e.render().el)})}},updatePositions:function(a,b,c){a.stopPropagation();b.collection.indexOf(b),b.get("parent");b.set("parent",this.model.id,{silent:!0}),b.collection.remove(b,{silent:!0}),this.model.elements.add(b,{at:c,silent:!0})},addElement:function(c,d,e){var f,g=b.View;switch(c.get("type")){case"input":case"url":case"email":case"date":case"phone":case"number":case"antispam":case"discount-code":f=new g.EOFormElementInputView({model:c});break;case"multiselect":f=new g.EOFormElementSelectView({model:c});break;default:f=new g.EOFormElementView({model:c})}var h=f.render().el;a(">ul",this.el).append(h),e&&e.scroll&&a("html, body").animate({scrollTop:a(h).offset().top-50},400)},toggleSettingsVisibility:function(b){b.stopPropagation(),a("#eo-bfc-element-"+this.model.id+" .eo-bfc-settings-toggle-arrow",this.el).html(a("#eo-bfc-element-"+this.model.id+" .eo-bfc-settings",this.el).toggle().is(":visible")?"&#x25B2;":"&#x25BC;"),a("html, body").animate({scrollTop:a(this.el).offset().top-50},400)},stopPropagation:function(a){a.stopPropagation()},dropped:function(a,b){a.stopPropagation(),this.$el.trigger("update-sort",[this.model,b])},updateSettings:function(a){switch(a.get("type")){case"input":case"textarea":this.model.set(a.id,a.get("value"));break;case"checkbox":this.model.set(a.id,a.get("checked"));break;case"range":the_min_id=a.get("min_id"),the_max_id=a.get("max_id");var b={};b[the_min_id]=a.get("value_min"),b[the_max_id]=a.get("value_max"),this.model.set(b);break;case"options":this.model.set({options:a.get("options"),selected:a.get("selected")})}}});var d=b.View.EOFormElementView;b.View.EOFormElementInputView=d.extend({exampleTemplate:a("#tmpl-eo-form-element-example-input").html()}),b.View.EOFormElementSelectView=d.extend({exampleTemplate:a("#tmpl-eo-form-element-example-select").html()}),b.View.EOFormSettingView=Backbone.View.extend({tagName:"tr",events:{keyup:"triggerSettingChanged",change:"triggerSettingChanged","click .eo-bfc-inline-help":"preventDefault"},initialize:function(){this.template=_.template(a("#tmpl-eo-form-element-setting-"+this.model.get("type")).html()),this.model.get("live_update")?this.events.keyup="triggerSettingChanged":delete this.events.keyup},render:function(){return this.$el.empty().append(this.template(this.model.toJSON())),this.model.get("inline_help")&&a(".eo-bfc-inline-help",this.$el).qtip({content:{title:this.model.get("inline_help").title,text:this.model.get("inline_help").text},show:{solo:!0},style:{classes:"qtip-wiki qtip-light qtip-shadow"},position:{viewport:a(window)}}),this},triggerSettingChanged:function(b){var c=b.keyCode||b.which;if(!c||"9"!=c)switch(this.model.get("type")){case"input":this.model.set("value",this.$el.find("input").val());break;case"textarea":this.model.set("value",this.$el.find("textarea").val());break;case"range":this.model.set({value_min:this.$el.find('input[data-type="min"]').val(),value_max:this.$el.find('input[data-type="max"]').val()});break;case"checkbox":if(this.model.get("options")){var d=this.$el.find('input[type="checkbox"]:checked').map(function(){return a(this).val()}).get();this.model.set("checked",d)}else this.model.set("checked",this.$el.find('input[type="checkbox"]').prop("checked")?1:0)}},preventDefault:function(a){a.preventDefault()}}),b.View.EOFormElementSettingOptionsView=b.View.EOFormSettingView.extend({initialize:function(){_.bindAll(this,"render"),this.template=_.template(a("#tmpl-eo-form-element-setting-"+this.model.get("type")).html())},events:{"keyup li input":"optionChanged","change input[type=radio]":"optionSelected","change input[type=checkbox]":"optionSelected","click .eo-bfc-option-add":"addOptionClicked","click .eo-bfc-option-remove":"removeOptionClicked"},render:function(){var b=this;return this.$el.empty(),this.$el.append(this.template(this.model.toJSON())),show_remove_option=this.model.get("options").length>1,_.each(this.model.get("options"),function(c,d){var e={option:c,index:d,selected:b.model.is_selected(d),option_type:b.model.get("option_type"),group:b.model.cid,show_remove_button:show_remove_option};a("ul",b.el).append(_.template(a("#tmpl-eo-form-element-setting-options-option").html(),e))}),this},addOptionClicked:function(b){var c=a(b.currentTarget).parents("li").index();this.model.insertOptionAt("New option",c+1),this.render()},removeOptionClicked:function(b){var c=a(b.currentTarget).parents("li").index();this.model.removeOptionAt(c),this.render()},optionSelected:function(){var b;b="checkbox"==this.model.get("option_type")?a("input:checkbox:checked",this.$el).map(function(){return a(this).parents("li").index()}).get():a("input:radio:checked",this.$el).map(function(){return a(this).parents("li").index()}).get(),this.model.setSelected(b)},optionChanged:function(b){var c=b.keyCode||b.which;if(!c||"9"!=c){var d=a(b.currentTarget).parents("li").index(),e=a(b.currentTarget).val();this.model.setOption(e,d)}}}),a(document).ready(function(){var a=new b.Model.EOForm(eo.form),c=new b.Model.EOFormController({form:a,forms:eo.forms,metaboxes:eo.element_types}),d=new b.View.EOFormControllerView({model:c});d.render()})}(jQuery);