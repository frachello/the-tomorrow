/*! event-organiser-pro 1.8.1 2014-08-11 22:40 */
var eventorganiserpro=eventorganiserpro||{};eventorganiserpro.Model={},eventorganiserpro.View={},eventorganiserpro.Collection={},function(a){jQuery(document).ready(function(a){a(".eo-show-if-js").show(),a(".eo-hide-if-js").hide(),a(".eo-enable-if-js").attr("disabled",!1),a(".eo-disable-if-js").attr("disabled",!0),a(".eo-booking-form-login-form").hide(),a(".eo-booking-no-account-prompt").hide(),a(".eo-booking-login-toggle").click(function(b){b.preventDefault(),a(".eo-booking-login-prompt").hide(),a(".eo-booking-no-account-prompt").show(),a(".eo-booking-form-login-form").show(),a("#eo-booking-form").hide()}),a(".eo-booking-no-account-toggle").click(function(b){b.preventDefault(),a(".eo-booking-no-account-prompt").hide(),a(".eo-booking-login-prompt").show(),a(".eo-booking-form-login-form").hide(),a("#eo-booking-form").show()})}),eventorganiserpro.Model.EOTicket=Backbone.Model.extend({defaults:{name:"",available:0,quantity:0,price:0},increase_quantity:function(){this.set("quantity",this.get("quantity")+1)},decrease_quantity:function(){qty=Math.max(0,this.get("quantity")-1),this.set("quantity",qty)}}),eventorganiserpro.Collection.EOTickets=Backbone.Collection.extend({model:eventorganiserpro.Model.EOTicket}),eventorganiserpro.Model.EOEvent=Backbone.Model.extend({defaults:{occurrence_id:!1,occurrence_date:!1,show_datepicker:!1},initialize:function(){this.get("show_datepicker")&&!this.get("occurrence_id")&&(occurrence=this.get("occurrence_date")?this.get_occurrence_by_date(this.get("occurrence_date")):this.get_next_available_occurrence(),this.set_occurrence(occurrence))},get_occurrence:function(a){var b=_.where(this.get("occurrences"),{id:parseInt(a,10)});return b?b[0]:!1},get_occurrence_by_date:function(a){var b=_.where(this.get("occurrences"),{date:a});return b?b[0]:!1},get_next_available_occurrence:function(){var a=new Date;a.setHours(23),a.setMinutes(59);var b=_.chain(this.get("occurrences")).filter(function(b){return date=new Date(b.date),b.available&&date>a}).sortBy(function(a){return new Date(a.date)}).first().value();return b?b:!1},set_occurrence:function(a){var b;b=!isNaN(parseFloat(a))&&isFinite(a)?this.get_occurrence(a):a,this.set("occurrence_date",b.date),this.set("occurrence_id",b.id)},set_occurrence_by_date:function(a){var b=this.get_occurrence_by_date(a);this.set_occurrence(b.id)},has_tickets_available:function(a){var b=_.where(this.get("occurrences"),{date:a});return b&&b.length>0?b[0].available:-1}}),eventorganiserpro.Model.EOCart=Backbone.Model.extend({defaults:{total:0,tickets:[],ticket_quantity:0,event:!1},initialize:function(){this.on("change:total",this._validate_total,this),this.get("tickets").on("change:quantity",this.calculate,this),this.get("tickets").on("change:price",this.calculate,this),this.get("event").on("change:occurrence_id",this.set_ticket_event_availability,this),this.calculate(),this.set_ticket_event_availability()},_validate_total:function(a,b){b=parseFloat(parseFloat(b).toFixed(2)),this.set(b)},set_ticket_event_availability:function(){var a=this.get("event");if(a.get("show_datepicker")){var b=a.get("occurrence_id"),c=a.get_occurrence(b);this.get("tickets")&&this.get("tickets").each(function(a){var b=0;c&&_.has(c.tickets,a.get("id"))&&(b=Math.max(0,c.tickets[a.get("id")])),a.set("available",b),a.get("quantity")>b&&a.set("quantity",b)})}},calculate:function(){var a=0,b=0;this.get("tickets").each(function(c){a+=parseInt(c.get("quantity"),10),b+=parseInt(c.get("quantity"),10)*parseFloat(c.get("price"))}),b=parseFloat(b),a=parseInt(a,10);var c={total:b,quantity:a,basket:this,occurrence:this.get("event").get_occurrence(this.get("event").get("occurrence_id")),event_id:this.get("event").get("id")};c=wp.hooks.applyFilter("eventorganiser.checkout_cart",c),c.total=wp.hooks.applyFilter("eventorganiser.checkout_total",c.total,c),this.set("total",c.total.toFixed(2)),this.set("ticket_quantity",c.quantity)}}),eventorganiserpro.View.EOEventView=Backbone.View.extend({events:{"change select#eo_occurrence_picker_select":"set_occurrence"},initialize:function(){this.setElement(a(".eo-booking-ticket-picker")),this.model.on("change:occurrence_id",this.update_view,this),_.bindAll(this,"beforeShowDay","set_occurrence_by_date"),this.render(),this.update_view()},render:function(){var a=this.$el.find("#eo-booking-occurrence-picker");0!=a.length&&a.datepicker({dateFormat:"yy-mm-dd",firstDay:parseInt(EO_Pro_DP.startday,10),changeMonth:!0,changeYear:!0,nextText:EO_Pro_DP.locale.nextText,prevText:EO_Pro_DP.locale.prevText,monthNamesShort:EO_Pro_DP.locale.monthAbbrev,dayNamesMin:EO_Pro_DP.locale.dayAbbrev,beforeShowDay:this.beforeShowDay,onSelect:this.set_occurrence_by_date}).children().addClass("eo-datepicker")},beforeShowDay:function(b){var c=a.datepicker.formatDate("yy-mm-dd",b),d=this.model.has_tickets_available(c);return 1===d?[!0,"ui-state-active eo-occurrence-id-"+this.model.get("occurrence_id"),""]:0===d?[!1,"ui-state-active eo-booking-no-tickets-available",""]:[!1,"ui-state-disabled",""]},set_occurrence:function(){var a=this.$el.find("#eo_occurrence_picker_select").val();this.model.set_occurrence(a)},set_occurrence_by_date:function(a){this.model.set_occurrence_by_date(a)},update_view:function(){var b=new Date(this.model.get("occurrence_date"));this.$el.find("#eo-booking-occurrence-picker").datepicker("setDate",b),this.$el.find("#eo_occurrence_picker_select").val(this.model.get("occurrence_id")),a("#eo-booking-select-date").hide(),a("#eo-booking-occurrence-id").val(this.model.get("occurrence_id")),a("#eo-booking-occurrence-date").val(this.model.get("occurrence_date"))}}),eventorganiserpro.View.EOTicketView=Backbone.View.extend({events:{"change input":"update_ticket",deselect:"update_ticket"},initialize:function(){this.setElement(a("#eo-booking-ticket-"+this.model.get("id"))),_.bindAll(this,"update_ticket"),this.model.on("change:available",this.render,this),this.model.on("change:quantity",this.render,this),this.render()},render:function(){var a=this.$el.find('[data-eo-ticket-qty="'+this.model.get("id")+'"]');a.is(":checkbox")||a.is(":radio")?(qty=a.is(":checked")?1:0,a.val(a.is(":radio")?this.model.get("id"):this.model.get("quantity"))):(qty=parseInt(a.val(),10),a.attr("max",this.model.get("available")),a.val(this.model.get("quantity"))),this.model.get("available")>0?this.$el.show():this.$el.hide()},update_ticket:function(){var b=0,c=this.$el.find('[data-eo-ticket-qty="'+this.model.get("id")+'"]');""!==c.val()&&(c.is(":checkbox")||c.is(":radio")?(b=c.is(":checked")?1:0,b>0&&c.is(":radio")&&a('input[name="'+c.attr("name")+'"]').not(c).trigger("deselect")):b=parseInt(c.val(),10)),this.model.set("quantity",b)}}),eventorganiserpro.View.EOCartView=Backbone.View.extend({initialize:function(){this.setElement(a(".eo-booking-ticket-picker")),this.$el.find(".eo-booking-total-row").css("visibility","hidden"),this.$el.find(".eo-booking-total-row").show(),_.bindAll(this,"update_view"),this.model.on("change",this.update_view,this),this.update_view()},update_view:function(){this.model.get("ticket_quantity")>0?this.$el.find(".eo-booking-total-row").css("visibility","visible"):this.$el.find(".eo-booking-total-row").css("visibility","hidden"),this.$el.find(".eo-booking-total-amount").text(this.model.get("total")),this.$el.find(".eo-booking-total-quantity").text(this.model.get("ticket_quantity"))}})}(jQuery),jQuery(document).ready(function(a){var b=!1,c=!1;a("#eo-booking-occurrence-id").val()&&0!==parseInt(a("#eo-booking-occurrence-id").val(),10)&&(b=a("#eo-booking-occurrence-date").val(),c=parseInt(a("#eo-booking-occurrence-id").val(),10)),eventorganiserpro.book_series?c=0:c||eventorganiserpro.event.is_recurring||(c=eventorganiserpro.event.occurrence_ids[0]),eventorganiserpro.models={},eventorganiserpro.collections={},eventorganiserpro.views={eoTicketViews:!1},eventorganiserpro.models.eoEvent=new eventorganiserpro.Model.EOEvent({occurrences:eventorganiserpro.occurrences,event_id:eventorganiserpro.event.id,show_datepicker:eventorganiserpro.event.show_datepicker,occurrence_date:b,occurrence_id:c}),eventorganiserpro.collections.eoTickets=new eventorganiserpro.Collection.EOTickets;for(var d in eventorganiserpro.tickets_obj)if(eventorganiserpro.tickets_obj.hasOwnProperty(d)){var e=eventorganiserpro.tickets_obj[d];e.id=d,eoTicket=new eventorganiserpro.Model.EOTicket(e),eventorganiserpro.collections.eoTickets.push(eoTicket),eventorganiserpro.views.eoTicketViews[d]=new eventorganiserpro.View.EOTicketView({model:eoTicket})}eventorganiserpro.eoCart=new eventorganiserpro.Model.EOCart({tickets:eventorganiserpro.collections.eoTickets,event:eventorganiserpro.models.eoEvent}),eventorganiserpro.views.eoEventView=new eventorganiserpro.View.EOEventView({model:eventorganiserpro.eoCart.get("event")}),eventorganiserpro.views.eoCartView=new eventorganiserpro.View.EOCartView({model:eventorganiserpro.eoCart}),eventorganiserpro.eoCart.calculate(),a(".eo-booking-field-date").length>0&&(a(".eo-booking-field-date").datepicker({dateFormat:"yy-mm-dd",nextText:EO_Pro_DP.locale.nextText,prevText:EO_Pro_DP.locale.prevText,beforeShow:function(b,c){c.hasOwnProperty("dpDiv")?c.dpDiv.addClass("eo-datepicker"):a("#ui-datepicker-div").addClass("eo-datepicker")},changeMonth:!0,changeYear:!0,monthNamesShort:EO_Pro_DP.locale.monthAbbrev,dayNamesMin:EO_Pro_DP.locale.dayAbbrev,firstDay:parseInt(EO_Pro_DP.startday,10)}),a(".eo-booking-field-date").each(function(){if(a(this).datepicker("option","dateFormat",a(this).data("dateformat")),a(this).data("defaultdate")){var b=new Date(a(this).data("defaultdate"));a(this).datepicker("option","defaultDate",b)}})),a("#eo-booking-form").submit(function(){var b=a(this);b.find("input[type=submit]").prop("disabled",!0),b.find(".eo-booking-form-waiting").show()})});